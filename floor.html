<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>INFORMATION</title>

        <link rel="shortcut icon" type="image/x-icon" href="./images/favicons.png">

        <link rel="stylesheet" href="include/css/common.css">
        <link rel="stylesheet" href="include/css/floor.css">

        <script src="include/js/eltovway/eltovway.js"></script>
        <script src="include/js/common.js"></script>
        <script src="include/js/jquery-3.7.0.js"></script>
        <script src="include/js/jquery.xml2json.js"></script>
        <script src="include/js/pinchzoom.js"></script>
        <script src="include/js/TweenMax.min.js"></script>
        <!--<link rel="stylesheet" href="include/css/eltovway/eltovmap.css">-->

       <!-- <script src="include/js/lib/jquery-3.2.1.js"></script>
        <script src="include/js/tweenmax/TweenLite.js"></script>
        <script src="include/js/tweenmax/TweenMax.js"></script>
        <script src="include/js/tweenmax/plugins/CSSPlugin.js"></script>-->
        <!--<script src="include/js/eltovway/zeltovway2d.min.js"></script>-->
        <!--<script src="include/js/eltovway/eltov2dmap.js"></script>
        <script src="include/js/eltovway/eltov2dfloor.js"></script>
        <script src="include/js/eltovway/eltovwayfind.js"></script>
        <script src="include/js/eltovway/eltovwayutil.js"></script>
        <script src="include/js/eltovway/eltovwayxml.js"></script>-->
    </head>


    <body>
        <!-- CONTENTS START //-->
        <div>
            <!-- MAP START //-->
            <div id="mapArea" class="map_area">
                <div id="mapContainer" class="map_main"></div>

                <div class="popup_security" style="display: none;">
                    <div class="popup_base">
                        <div class="popup_box">
                            <div class="security_info">
                                <div class="security_title">
                                    <h3>
                                        <img src="./images/security.svg" alt="보안검색대 통과 아이콘">
                                        <span class="desc lang_code_names">보안검색대 통과</span>
                                    </h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--TODO 매장리스트-->
                <!-- <div class="floor_category_area">
                    <div class="category_title_area open">
                        <h3 class="category_title">시설목록</h3>
                        <button><img src="images/arrow_down.svg" alt="펼쳐보기"></button>
                    </div>
                    <ul class="category_result">
                        <li><button>약 20자 이상은 말줄임표⋯ 약 20자 이상은 말줄임표⋯ 약 20자 이상은 말줄임표⋯ </button></li>
                        <li class="active"><button>CU편의점(T2)</button></li>
                        <li><button>GS25편의점(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                    </ul>
                </div> -->
            </div>
        </div>
        <!-- CONTENTS END //-->

        <script>
          const urlParams = new URLSearchParams(window.location.search);
          const kioskCode = urlParams.get("kiosk_code");
          // const serverHost = "http://192.168.0.10:8090";
          // const serverHost = "https://dev.tovair.com:10180";
          const contentsURL = `/xml/kiosk_contents.xml`;
          const routeUrl = `/xml/getRouteXml.xml`;
          // const contentsURL = `${serverHost}/user/xml/kiosk_contents.jsp?kiosk_code=${kioskCode}`;
          // const routeUrl = `${serverHost}/t2/system/route/getRouteXml`;
          let MapContainer = document.getElementById("mapContainer");
        
          let param = {
            kioskCode: kioskCode,
            mapContainer: MapContainer,
            canvasLineYn: "N", // Y이면 선, N이면 점
            canvasColor: "#FF0080",
            securityTime: 20, // 보안구역 소요시간(분 단위)
            eleTime: 10, // 엘리베이터 소요시간(분 단위)
            escTime: 10, // 보안구역 소요시간(분 단위)
            defaultMapRate: 0.8, // 기본 scale
            smallMapRate: 0.3, // 전체 지도 표출 scale
            bigMapRate: 1.0, // 도착지 확대 scale
          };
          let eltovMap = new eltovway.Maps(param);
        
          window.addEventListener("DOMContentLoaded", function () {
            eltovMap.init();
          });
        
          // iframe(부모창)에서 호출된 메시지
          window.addEventListener("message", function (e) {
            /* 부모창에서 호출된 메시지를 자식창에서 받는 부분 */
            switch (e.data.sect) {
              // 길안내
              case "WAYFIND":
                // 길안내 데이터 전달 팝업
                onClickPopUpWayFind(e.data.sect, e.data.type, e.data.id);
                break;
        
              // 현재 위치
              case "MYLOCATION":
                eltovMap.loadCurrent(); // 현재 위치 함수 호출
                break;
        
              // 매장 팝업
              case "STOREPOPUP":
                // 매장 데이터 전달 팝업
                onClickPopUpStoreInfo(e.data.type, e.data.id, true);
                break;
        
              // 편의시설
              case "FACILITY":
                // 편의 시설 데이터 전달 팝업
                onClickPopUpFacility(e.data.floor, e.data.type, e.data.midCategory, e.data.bigCategory);
                break;
        
              // 대분류
              case "BIGCATEGORY":
                // 대분류에 해당하는 상점 데이터 전달 함수
                eltovMap.setStoreIconAllShow(e.data.bigCategory, e.data.floor);
                break;
        
              // 층 변경
              case "FLOOR":
                // KIOSK_CONTENTS.XML의 키오스크 층과 데이터에서 받은 층이 동일하면
                if (eltovMap.header.KIOSK_FLOOR.text === e.data.type) {
                  eltovMap.loadCurrent(); // 현재 위치 함수 호출
                } else {
                  eltovMap.onClickFloorbtn(e.data.type); // 아닐 경우에 층버튼 클릭 함수 호출
                }
                break;
        
              // 언어 변경
              case "LANG":
                eltovMap.setMainLang(e.data.type); // 언어 변경 함수 호출
                break;
        
              // 닫기 버튼 시 지도 초기화
              case "CLOSE":
                eltovMap.loadCurrent(); // 현재 위치 함수 호출
                break;
            }
          });
        
          //편의 시설(AED, 유아휴게실, 흡연실, 화장실) 클릭시
          function onClickPopUpFacility(floorCode, type, midCate, bigCate) {
            if (bigCate !== "109") return;
            // 해당 PUBLIC_CODE의 아이콘 이벤트 함수 호출
            midCate ? eltovMap.onClickPubIcon(floorCode, midCate) : '';
          }
        
          //스토어 정보 클릭시
          function onClickPopUpStoreInfo(type, id, isIframe) {
            eltovMap.loadCurrent(); // 현재 위치 함수 호출
            // 전달 받은 스토어 아이디와 TRUE(위치안내 버튼 O) / FALSE(위치안내 버튼 X)값 전달
            eltovMap.onClickInfoStoreById(id, isIframe);
          }
        
          // 길안내 버튼 클릭시
          function onClickPopUpWayFind(p_sect, p_type, id) {
            // 전달 받은 타입의 길안내 이벤트
            if(p_type === 'TRANSFER_FLIGHT'){
              const flightRouteObj = eltovMap.storeRouteList.find(item => item.gate_no === id);
              eltovMap.wayfindById(flightRouteObj.id);
            } else if (p_type === "PARK" ) {
              eltovMap.wayfindParkById(id); // 해당 주차ID 전달하여 길안내 시작
            } else {
              eltovMap.wayfindById(id); //  상점 아이디 전달하여 길안내 시작
            }
          }
        </script>
    </body>
    
</html>


