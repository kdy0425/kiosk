<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Expires" content="-1">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Cache-Control" content="no-cache">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <title>INFORMATION</title>

        <link rel="shortcut icon" type="image/x-icon" href="./images/favicons.png">

        <link rel="stylesheet" href="include/css/common.css">
        <link rel="stylesheet" href="include/css/floor.css">

        <script src="include/js/eltovway/eltovway.js"></script>
        <script src="include/js/common.js"></script>
        <script src="include/js/jquery-3.7.0.js"></script>
        <script src="include/js/jquery.xml2json.js"></script>
        <script src="include/js/pinchzoom.js"></script>
        <script src="include/js/TweenMax.min.js"></script>
        <!--<link rel="stylesheet" href="include/css/eltovway/eltovmap.css">-->

       <!-- <script src="include/js/lib/jquery-3.2.1.js"></script>
        <script src="include/js/tweenmax/TweenLite.js"></script>
        <script src="include/js/tweenmax/TweenMax.js"></script>
        <script src="include/js/tweenmax/plugins/CSSPlugin.js"></script>-->
        <!--<script src="include/js/eltovway/zeltovway2d.min.js"></script>-->
        <!--<script src="include/js/eltovway/eltov2dmap.js"></script>
        <script src="include/js/eltovway/eltov2dfloor.js"></script>
        <script src="include/js/eltovway/eltovwayfind.js"></script>
        <script src="include/js/eltovway/eltovwayutil.js"></script>
        <script src="include/js/eltovway/eltovwayxml.js"></script>-->
    </head>


    <body>
        <!-- CONTENTS START //-->
        <div>
            <div id="id_pop_floor_guide" class="pop_floor_guide" style="display: none;">
                <img src="./images/floor_ico_touch.svg">
                <!-- <div class="desc lang_code_names" lang_code="GUIDE_SWIPE">
                    지도 확대/축소가 가능합니다
                </div> -->
            </div>

            <!-- MAP START //-->
            <div id="mapArea" class="map_area">
                <div id="mapContainer" class="map_main"></div>

                <div class="security_area" style="display:none;">
                    <div class="desc">보안 검색대 통과</div>
                </div>
                <!--TODO 매장리스트-->
                <!--<div class="floor_category_area">
                    <div class="category_title_area open">
                        <h3 class="category_title">편의점/포장식품</h3>
                        <button><img src="images/arrow_down.svg" alt="펼쳐보기"> </button>
                    </div>
                    <ul class="category_result">
                        <li><button>약 20자 이상은 말줄임표⋯ 약 20자 이상은 말줄임표⋯ 약 20자 이상은 말줄임표⋯ </button></li>
                        <li class="active"><button>CU편의점(T2)</button></li>
                        <li><button>GS25편의점(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                        <li><button>다나누리(한국식료품점)(T2)</button></li>
                    </ul>
                </div>-->
            </div>
        </div>
        <!-- CONTENTS END //-->

    </body>
</html>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const kioskCode = urlParams.get('kiosk_code');
    const serverHost = "http://192.168.0.10:8090";
    const contentsURL = `${serverHost}/user/xml/kiosk_contents.jsp?kiosk_code=${kioskCode}`;
    // const routeUrl = `${serverHost}/t2/system/route/getRouteXml`;
    // const contentsURL = "/xml/kiosk_contents.xml";
    const routeUrl = '/xml/getRouteXml.xml';
    let MapContainer = document.getElementById("mapContainer");
    let eltovMap = new eltovway.Maps(kioskCode, MapContainer);
        
    window.addEventListener('DOMContentLoaded', function(){
        eltovMap.init();
    });

    window.addEventListener('message', function(e) {
        // if(e.data.sect !== 'CATEGORY'){
        //     eltovMap.loadCurrent();
        // }
        eltovMap.storeIconRemove()
        console.log('====================== ELTOV START ========================');
        console.log(e.data, 'e.data')
        console.log('===========================================================')

        /* 부모창에서 호출된 메시지를 자식창에서 받는 부분 */
        switch(e.data.sect){
            case 'WAYFIND' : {
                onClickPopUpWayFind(e.data.sect, e.data.type, e.data.id);
            }
            break;
            case 'MYLOCATION' : {
                eltovMap.loadCurrent();
                eltovMap.closeStorePopup();
            }
            break;

            case 'STOREPOPUP' : {
                onClickPopUpStoreInfo(e.data.type, e.data.id);
            }
            break;

            case 'FACILITY' : {
                onClickPopUpFacility(e.data.floor, e.data.type);
            }
            break;

            case 'BIGCATEGORY' : {
                eltovMap.setStoreIconAllView(e.data.bigCategory, e.data.floor);
            }
            break;

            case 'MIDCATEGORY' : {
                eltovMap.setStoreIconView(e.data.midCategory, e.data.floor);
            }
            break;

            case 'FLOOR' : {
                eltovMap.onClickFloorbtn(e.data.type);
            }
            break;

            // 언어 변경
            case 'LANG' : {
                eltovMap.setMainLang(e.data.type);
            }
            break;

            // 닫기 버튼 시 지도 초기화
            case 'CLOSE' : {
                eltovMap.loadCurrent();
            }
            break;
        }
    })

    //카테고리 팝업 클릭시
    function onClickPopUpCategory(edata) {
        // console.log('onClickPopUpCategory edata :  ', edata);
        // 여기서 특정 카테고리의 상점 아이콘을 활성화 시키는 이벤트를 배치하면 됨
        // switch (type) {
        //     case 'aed': {

        //     }
        //         break;

        //     case 'infant': {

        //     }
        //         break;

        //     case 'smoke': {

        //     }
        //         break;

        //     case 'toilet': {
        //         onClickPubInfo("P10");
        //     }
        //         break;
        // }
    }


    //편의 시설(AED, 유아휴게실, 흡연실, 화장실) 클릭시
    function onClickPopUpFacility(floorCode, type) {
        switch(type) {
            case 'aed' : {
                eltovMap.onClickPubIcon(floorCode, "P11");
            }
            break;

            case 'infant' : {
                eltovMap.onClickPubIcon(floorCode, "P12");
            }
            break;

            case 'smoke' : {
                eltovMap.onClickPubIcon(floorCode, "P13");
            }
            break;

            case 'toilet' : {
                eltovMap.onClickPubIcon(floorCode, "P10");
            }
            break;
        }
    }

    //스토어 정보 클릭시
    function onClickPopUpStoreInfo(type,id) {
        // setMakeInfoPopUpStore({id : id})
        eltovMap.onClickInfoStoreById(id)
    }

    function onClickPopupClose(p_type) {
        switch(p_type) {
            case 'STORE' : {
                $("#id_popup_store").fadeOut();
                $("#id_popup_fnb").fadeOut();
            }
            break;

            case 'WAYTYPE' : {
                $("#id_popup_waytype").fadeOut();
            }
            break;

            case 'FACILITY' : {
                $("#id_popup_fac").fadeOut();
            }
            break;

            case 'ERROR' : {
                $("#id_popup_error").fadeOut();
            }
            break;
        }
    }

    function onClickPopUpWayFind(p_sect, p_type, id) {
        console.log(' ====================== ELTOV WAYFIND ========================')
        let way_obj = {
            sect: p_sect,
            type: p_type,
            id: "",
            move_type: "",
            floor: ""
        };

        switch(p_type){
            case 'STORE' : {
                way_obj.id = (id === 0 ? gl_main_conf.pop_store_id : id);
                onClickPopupClose("STORE");
            }
            break;

            case 'PUB' : {
                way_obj.id = id;
                onClickPopupClose("PUB");
            }
            break;

            case 'PARK' : {
                way_obj.id = id;
                onClickPopupClose("PARK");
            }
            break;
        }
        eltovMap.wayfindById(id);
    }
</script>